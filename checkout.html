
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>結帳 - 9's Pilates Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
      body {
        font-family: 'Noto Sans TC', sans-serif;
        background-color: #efefef;
        color: #292524; /* text-stone-800 */
      }
      .font-serif {
        font-family: 'Playfair Display', serif;
      }
      .transform { transition: transform 0.3s ease-in-out; }
      .opacity-transition { transition: opacity 0.3s ease-in-out; }
        .notification-item {
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
            display: block;
            text-decoration: none;
        }
        .notification-item:hover {
            background-color: #f5f5f4; /* stone-100 */
        }
        .notification-item.unread {
            background-color: #f7f5f2; /* A lighter version of brand color */
        }
        .notification-item p {
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: #44403c; /* stone-700 */
            margin-bottom: 0;
        }
        .notification-item time {
            font-size: 0.75rem;
            line-height: 1rem;
            color: #a8a29e; /* stone-400 */
            margin-top: 0.25rem;
            display: block;
        }
        #personal-notifications-list::-webkit-scrollbar { width: 6px; }
        #personal-notifications-list::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px;}
        #personal-notifications-list::-webkit-scrollbar-thumb { background: #d4d4d4; border-radius: 3px;}
        #personal-notifications-list::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body class="bg-[#efefef] text-stone-800">

    <!-- Header -->
    <header class="sticky top-0 bg-[#e3dfdc]/80 backdrop-blur-md z-40 shadow-sm">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-20">
          <div class="flex-shrink-0">
            <a href="index.html" class="flex items-center space-x-2">
               <img class="h-10 w-auto" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iNzgiIHZpZXdCb3g9IjAgMCAzMDAgNzgiPjxzdHlsZT4ud2VpZ2h0LTkwMCB7IGZvbnQtd2VpZ2h0OiA5MDA7IH0gLmN1cnNpdmUgeyBmb250LWZhbWlseTogJ1BsYXlmYWlyIERpc3BsYXksIHNlcmlmJzsgZm9udC1zdHlsZTogaXRhbGljOyB9IC5zZXJpZiB7IGZvbnQtZmFtaWx5OiAnUGxheWZhaXIgRGlzcGxheScsIHNlcmlmOyB9PC9zdHlsZT48dGV4dCB4PSIxMCIgeT0iNzAiIGZvbnQtZmFtaWx5PSJQbGF5ZmFpciBEaXNwbGF5LCBzZXJpZiIgZm9udC1zaXplPSI5MCIgZmlsbD0iIzAwMCI+PXRzcGFuIHg9IjEwIiBkeT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiPkY8L3RzcGFuPjx0c3BhbiB4PSI0OCIgZHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIj5GOy90c3Bhbj48L3RleHQ+PHRleHQgeD0iMTA1IiB5PSI1MiIgc3R5bGU9ImZvbnQtZmFtaWx5OiAnUGxheWZhaXIgRGlzcGxheScsIHNlcmlmOyBmb250LXNpemU6IDI4cHc7IGxldHRlci1zcGFjaW5nOiAycHg7Ij48dHNwYW4geD0iMTA1IiBkeT0iMCIgY2xhc3M9ImN1cnNpdmUiPjwnczwvdHNwYW4+PHRzcGFuIHg9IjE0MCIgZHk9IiI+IFBJTFRFUzwvdHNwYW4+PC90ZXh0Pjwvc3ZnPg==" alt="9's Pilates Logo" />
            </a>
          </div>
          <nav class="hidden lg:flex lg:items-center lg:space-x-8">
            <div class="relative group">
                <a href="courses.html" class="text-stone-600 hover:text-[#c1bcb8] transition-colors flex items-center" data-translate-key="nav_all_courses">
                    全部課程 <i class="fas fa-chevron-down text-xs ml-1 transition-transform group-hover:rotate-180"></i>
                </a>
                <div class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none group-hover:pointer-events-auto">
                    <a href="courses.html#single-session" class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100" data-translate-key="nav_single_session">單堂體驗</a>
                    <a href="courses.html#thematic-unit" class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100" data-translate-key="nav_thematic_unit">主題單元</a>
                    <a href="courses.html#sculpting-plan" class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100" data-translate-key="nav_sculpting_plan">體態雕塑</a>
                </div>
            </div>
            <a href="pilates-classroom.html" class="text-stone-600 hover:text-[#c1bcb8] transition-colors" data-translate-key="nav_classroom">皮拉提斯小教室</a>
            <a href="faq.html" class="text-stone-600 hover:text-[#c1bcb8] transition-colors" data-translate-key="nav_faq">常見問題</a>
          </nav>
          <div class="flex items-center space-x-4">
            <button id="user-icon-button" class="relative text-stone-600 hover:text-[#c1bcb8] transition-colors" aria-label="User account">
                <i aria-hidden="true" class="fas fa-user text-xl"></i> 
             </button>
             <button id="login-logout-button" class="hidden lg:block text-stone-600 hover:text-[#c1bcb8] transition-colors font-medium text-sm px-3 py-2 rounded-md"></button>
            <button id="menu-button" class="lg:hidden text-stone-600 hover:text-[#c1bcb8] transition-colors" aria-label="Open menu">
              <i aria-hidden="true" class="fas fa-bars text-xl"></i>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 opacity-transition opacity-0 pointer-events-none lg:hidden"></div>
    <div id="mobile-menu-panel" class="fixed top-0 left-0 h-full w-64 bg-white shadow-2xl z-50 transform -translate-x-full lg:hidden">
        <div class="flex flex-col h-full">
            <div class="flex items-center justify-between p-6 border-b border-stone-200">
                <h2 class="text-xl font-semibold text-stone-800" data-translate-key="mobile_menu_title">選單</h2>
                <button id="mobile-menu-close" class="text-stone-500 hover:text-stone-800 transition-colors">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <nav class="flex-grow p-6">
                <ul class="space-y-4">
                    <li><a href="courses.html" class="mobile-menu-link block py-2 text-lg text-stone-600 hover:text-[#c1bcb8] transition-colors" data-translate-key="nav_all_courses">全部課程</a></li>
                    <li><a href="pilates-classroom.html" class="mobile-menu-link block py-2 text-lg text-stone-600 hover:text-[#c1bcb8] transition-colors" data-translate-key="nav_classroom">皮拉提斯小教室</a></li>
                    <li><a href="faq.html" class="mobile-menu-link block py-2 text-lg text-stone-600 hover:text-[#c1bcb8] transition-colors" data-translate-key="nav_faq">常見問題</a></li>
                </ul>
            </nav>
            <div class="border-t border-stone-200 mt-auto p-6">
                <a href="#" id="mobile-login-logout-link" class="block py-2 text-lg text-stone-600 hover:text-[#c1bcb8] transition-colors"></a>
            </div>
        </div>
    </div>
    
    <main class="py-12 md:py-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <h1 class="text-4xl sm:text-5xl font-serif font-bold text-stone-800 tracking-tight" data-translate-key="checkout_title">結帳</h1>
            </div>

            <div id="checkout-content" class="max-w-4xl mx-auto">
                <!-- Checkout content will be injected by JS -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-stone-800 text-stone-300 mt-16">
        <div class="container mx-auto py-12 px-4 sm:px-6 lg:px-8 text-center">
            <img class="h-12 w-auto mx-auto mb-4" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iNzgiIHZpZXdCb3g9IjAgMCAzMDAgNzgiPjxzdHlsZT4ud2VpZ2h0LTkwMCB7IGZvbnQtd2VpZ2h0OiA5MDA7IH0gLmN1cnNpdmUgeyBmb250LWZhbWlseTogJ1BsYXlmYWlyIERpc3BsYXksIHNlcmlmJzsgZm9udC1zdHlsZTogaXRhbGljOyB9IC5zZXJpZiB7IGZvbnQtZmFtaWx5OiAnUGxheWZhaXIgRGlzcGxheScsIHNlcmlmOyB9PC9zdHlsZT48dGV4dCB4PSIxMCIgeT0iNzAiIGZvbnQtZmFtaWx5PSJQbGF5ZmFpciBEaXNwbGF5LCBzZXJpZiIgZm9udC1zaXplPSI5MCIgZmlsbD0iI2ZmZiI+PXRzcGFuIHg9IjEwIiBkeT0iMCIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjIiPkY8L3RzcGFuPjx0c3BhbiB4PSI0OCIgZHk9IjAiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxIj5GOy90c3Bhbj48L3RleHQ+PHRleHQgeD0iMTA1IiB5PSI1MiIgc3R5bGU9ImZvbnQtZmFtaWx5OiAnUGxheWZhaXIgRGlzcGxheScsIHNlcmlmOyBmb250LXNpemU6IDI4cHc7IGxldHRlci1zcGFjaW5nOiAycHg7IGZpbGw6ICNmZmY7Ij48dHNwYW4geD0iMTA1IiBkeT0iMCIgY2xhc3M9ImN1cnNpdmUiPjwnczwvdHNwYW4+PHRzcGFuIHg9IjE0MCIgZHk9IiI+IFBJTFRFUzwvdHNwYW4+PC90ZXh0Pjwvc3ZnPg==" alt="9's Pilates" />
            <div class="flex justify-center space-x-6 my-6">
                <a href="courses.html" class="hover:text-white transition-colors" data-translate-key="footer_all_courses">所有課程</a>
                <a href="faq.html" class="hover:text-white transition-colors" data-translate-key="nav_faq">常見問題</a>
                <a href="#" id="footer-login-link" class="hover:text-white transition-colors" data-translate-key="footer_member_login">會員登入</a>
            </div>
            <p class="my-4"><a href="mailto:9spilates@gmail.com" class="hover:text-white transition-colors"><span data-translate-key="footer_contact_email">客服信箱</span>：9spilates@gmail.com</a></p>
            <div class="flex justify-center space-x-6 my-6"><a href="#" class="text-stone-400 hover:text-white transition-colors" aria-label="Instagram"><i class="fab fa-instagram text-2xl"></i></a><a href="#" class="text-stone-400 hover:text-white transition-colors" aria-label="Line"><i class="fab fa-line text-2xl"></i></a></div>
            <p class="text-sm text-stone-400" data-translate-key="footer_copyright">© 2025 9's Pilates. 版權所有</p>
            <div class="flex justify-center space-x-4 mt-2 text-xs text-stone-500"><a href="terms.html" class="hover:text-stone-300 transition-colors" data-translate-key="footer_terms">使用條款</a><span>|</span><a href="privacy.html" class="hover:text-stone-300 transition-colors" data-translate-key="footer_privacy">隱私政策</a></div>
        </div>
    </footer>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- TRANSLATIONS & MOCK DATA ---
        const translations = {
            'en': {
                'page_title_checkout': "Checkout - 9's Pilates Studio", 'nav_all_courses': 'All Courses', 'nav_classroom': 'Pilates Classroom', 'nav_single_session': 'Single Session', 'nav_thematic_unit': 'Thematic Unit', 'nav_sculpting_plan': 'Body Sculpting', 'nav_faq': 'FAQ',
                'mobile_menu_title': 'Menu', 'footer_all_courses': 'All Courses', 'footer_member_login': 'Member Login', 'footer_contact_email': 'Contact Email', 'footer_copyright': '© 2025 9\'s Pilates. All Rights Reserved', 'footer_terms': 'Terms of Use', 'footer_privacy': 'Privacy Policy', 
                'login': 'Log In', 'logout': 'Log Out', 'logout_confirm': 'Are you sure you want to log out?', 'checkout_title': 'Checkout', 'order_summary': 'Order Summary', 'subtotal': 'Subtotal', 'discount': 'Discount', 'total': 'Total',
                'discount_code': 'Discount Code', 'apply_code': 'Apply', 'payment_details': 'Payment Details', 'card_number': 'Card Number', 'expiry_date': 'Expiry Date (MM/YY)', 'cvc': 'CVC', 'name_on_card': 'Name on Card',
                'place_order': 'Place Order', 'empty_cart_message': 'Your cart is empty.', 'continue_shopping': 'Continue Shopping', 'unauthorized_access': 'You must be logged in to view this page.', 'redirecting_home': 'Redirecting to homepage...',
                'order_successful': 'Order placed successfully!', 'order_failed': 'There was an issue with your payment.',
            },
            'zh-TW': {
                'page_title_checkout': "結帳 - 9's Pilates Studio", 'nav_all_courses': '全部課程', 'nav_classroom': '皮拉提斯小教室', 'nav_single_session': '單堂體驗', 'nav_thematic_unit': '主題單元', 'nav_sculpting_plan': '體態雕塑', 'nav_faq': '常見問題',
                'mobile_menu_title': '選單', 'footer_all_courses': '所有課程', 'footer_member_login': '會員登入', 'footer_contact_email': '客服信箱', 'footer_copyright': '© 2025 9\'s Pilates. 版權所有', 'footer_terms': '使用條款', 'footer_privacy': '隱私政策', 
                'login': '登入', 'logout': '登出', 'logout_confirm': '您確定要登出嗎？', 'checkout_title': '結帳', 'order_summary': '訂單摘要', 'subtotal': '小計', 'discount': '折扣', 'total': '總計',
                'discount_code': '折扣碼', 'apply_code': '套用', 'payment_details': '付款資訊', 'card_number': '信用卡號', 'expiry_date': '到期日 (MM/YY)', 'cvc': '安全碼', 'name_on_card': '持卡人姓名',
                'place_order': '確認付款', 'empty_cart_message': '您的購物車是空的。', 'continue_shopping': '繼續選購', 'unauthorized_access': '您必須登入才能查看此頁面。', 'redirecting_home': '正在將您導回首頁...',
                'order_successful': '訂單已成功送出！', 'order_failed': '您的付款發生問題。',
            }
        };

        // --- STATE ---
        let cartItems = [];
        let currentLanguage = 'zh-TW';

        // --- DOM ELEMENTS & HELPERS ---
        const getEl = (id) => document.getElementById(id);
        const t = (key) => translations[currentLanguage][key] || key;
        
        // --- TRANSLATION & UI UPDATE ---
        const updateStaticText = () => {
            document.title = t('page_title_checkout');
            document.querySelectorAll('[data-translate-key]').forEach(el => el.textContent = t(el.dataset.translateKey));
        };
        const setLanguage = (lang) => {
            currentLanguage = lang;
            localStorage.setItem('pilatesLanguage', lang);
            updateStaticText();
            renderCheckout();
        };

        // --- AUTH LOGIC ---
        const checkLoginStatus = () => { const isLoggedIn = sessionStorage.getItem('isLoggedIn') === 'true'; updateAuthUI(isLoggedIn); return isLoggedIn; };
        const handleLogout = () => { if (confirm(t('logout_confirm'))) { sessionStorage.removeItem('isLoggedIn'); sessionStorage.removeItem('user'); window.location.href = 'index.html'; } };
        const updateAuthUI = (isLoggedIn) => {
            getEl('user-icon-button').classList.toggle('text-[#c1bcb8]', isLoggedIn);
            getEl('login-logout-button').textContent = isLoggedIn ? t('logout') : t('login');
            getEl('mobile-login-logout-link').textContent = isLoggedIn ? t('logout') : t('login');
        };

        // --- CHECKOUT PAGE LOGIC ---
        const renderCheckout = () => {
            const container = getEl('checkout-content');
            if (!checkLoginStatus()) {
                container.innerHTML = `<div class="text-center py-20 bg-white rounded-lg shadow-md"><p class="text-lg">${t('unauthorized_access')}</p><p class="text-stone-500">${t('redirecting_home')}</p></div>`;
                setTimeout(() => window.location.href = 'index.html', 3000);
                return;
            }
            if (cartItems.length === 0) {
                container.innerHTML = `<div class="text-center py-16 bg-white rounded-lg shadow-md"><p class="text-lg">${t('empty_cart_message')}</p><a href="courses.html" class="mt-6 inline-block px-8 py-3 bg-[#c1bcb8] text-white rounded-full font-semibold hover:bg-[#b0a9a4] transition-colors">${t('continue_shopping')}</a></div>`;
                return;
            }

            const subtotal = cartItems.reduce((acc, item) => acc + item.price, 0);
            const discount = 0; // Logic for discount can be added here
            const total = subtotal - discount;

            container.innerHTML = `
                <div class="lg:grid lg:grid-cols-2 lg:gap-12">
                    <div class="bg-white p-8 rounded-lg shadow-md order-2 lg:order-1">
                        <h2 class="text-2xl font-serif font-bold mb-6">${t('payment_details')}</h2>
                        <form id="payment-form" class="space-y-4">
                            <div><label class="text-sm font-medium">${t('card_number')}</label><input type="text" placeholder="•••• •••• •••• ••••" class="w-full mt-1 p-3 border rounded-md focus:ring-2 focus:ring-[#c1bcb8] focus:border-transparent outline-none transition" required></div>
                            <div class="flex space-x-4">
                                <div class="flex-1"><label class="text-sm font-medium">${t('expiry_date')}</label><input type="text" placeholder="MM / YY" class="w-full mt-1 p-3 border rounded-md focus:ring-2 focus:ring-[#c1bcb8] focus:border-transparent outline-none transition" required></div>
                                <div class="flex-1"><label class="text-sm font-medium">${t('cvc')}</label><input type="text" placeholder="CVC" class="w-full mt-1 p-3 border rounded-md focus:ring-2 focus:ring-[#c1bcb8] focus:border-transparent outline-none transition" required></div>
                            </div>
                            <div><label class="text-sm font-medium">${t('name_on_card')}</label><input type="text" placeholder="${t('name_on_card')}" class="w-full mt-1 p-3 border rounded-md focus:ring-2 focus:ring-[#c1bcb8] focus:border-transparent outline-none transition" required></div>
                        </form>
                    </div>
                    <div class="mb-8 lg:mb-0 order-1 lg:order-2">
                         <div class="bg-white p-8 rounded-lg shadow-md">
                            <h2 class="text-2xl font-serif font-bold mb-6">${t('order_summary')}</h2>
                            <div id="summary-items" class="space-y-4 mb-6 border-b pb-6">
                                ${cartItems.map(item => `
                                    <div class="flex justify-between items-center">
                                        <span class="pr-4">${item.title[currentLanguage]}</span>
                                        <span class="font-semibold whitespace-nowrap">NT$ ${item.price.toLocaleString()}</span>
                                    </div>`).join('')}
                            </div>
                            <div class="space-y-2 mb-6">
                                <div class="flex justify-between"><span>${t('subtotal')}</span><span>NT$ ${subtotal.toLocaleString()}</span></div>
                                <div class="flex justify-between text-stone-500"><span>${t('discount')}</span><span>- NT$ ${discount.toLocaleString()}</span></div>
                            </div>
                            <div class="flex justify-between items-center font-bold text-xl border-t pt-4">
                                <span>${t('total')}</span><span>NT$ ${total.toLocaleString()}</span>
                            </div>
                            <button id="place-order-btn" type="submit" form="payment-form" class="w-full mt-6 py-3 bg-[#c1bcb8] text-white rounded-lg text-lg font-semibold hover:bg-[#b0a9a4] transition-colors">${t('place_order')}</button>
                        </div>
                    </div>
                </div>`;
            
            getEl('payment-form').addEventListener('submit', (e) => {
                e.preventDefault();
                alert(t('order_successful'));
                localStorage.removeItem('pilatesCart');
                window.location.href = 'dashboard.html';
            });
        };

        // --- GENERAL SETUP ---
        const init = () => {
            const savedLang = localStorage.getItem('pilatesLanguage') || (navigator.language.startsWith('en') ? 'en' : 'zh-TW');
            cartItems = JSON.parse(localStorage.getItem('pilatesCart') || '[]');
            setLanguage(savedLang);
            checkLoginStatus();
            
            getEl('menu-button')?.addEventListener('click', () => getEl('mobile-menu-panel').classList.remove('-translate-x-full'));
            getEl('mobile-menu-close')?.addEventListener('click', () => getEl('mobile-menu-panel').classList.add('-translate-x-full'));
            getEl('mobile-menu-backdrop')?.addEventListener('click', () => getEl('mobile-menu-panel').classList.add('-translate-x-full'));
            getEl('user-icon-button')?.addEventListener('click', () => window.location.href = 'dashboard.html');
            getEl('login-logout-button')?.addEventListener('click', () => { if (checkLoginStatus()) { handleLogout(); } else { /* This page requires login, so this case is unlikely */ } });
            getEl('mobile-login-logout-link')?.addEventListener('click', (e) => { e.preventDefault(); if (checkLoginStatus()) { handleLogout(); }});
        };

        init();
    });
    </script>
</body>
</html>
